<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
</head>
<body>
    <script src="Scripts/jquery-1.6.4.min.js"></script>
    <script src="Scripts/jquery.signalR-2.3.0.min.js"></script>
    <script src="signalr/hubs"></script>

    <script src="Scripts/vue.min.js"></script>

    <div id="app">
        <input id="userName" placeholder="userName" v-model="userName" />
        <input id="message" placeholder="message" v-model="message" />

        <button id="sendButton" v-on:click="sendMessage">send</button>
        <div id="container" v-for="m in messages">{{m.userName}} ：{{m.message}}</div>
    </div>

    <script>
        var app = new Vue({
            el: '#app',
            data: {
                userName: '',
                message: '',
                messages: [
                    { userName: 'Jeff', message: 'Hi' },
                    { userName: 'Ricky', message: '123' }
                ],
                chatHubProxy: {},
            },
            methods: {
                // 接收伺服器端回傳的訊息，並做處理
                insert: function (userName, message) {
                    this.messages.push({ userName: userName, message: message });
                },
                // 傳送訊息到伺服器端
                sendMessage: function () {
                    this.chatHubProxy.server.sendMessage(this.userName, this.message);
                }
            },
            created() {
                this.chatHubProxy = $.connection.chat;
                // 註冊發送訊息後，JS的接收事件
                this.chatHubProxy.client.recievMessage = this.insert;
                // 與伺服器連接
                $.connection.hub.start().done(this.done);
            }
        })
    </script>
</body>
</html>